<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>CoreTrex - Projects</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="clients.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script>
        // Authentication check - redirect to login if not logged in
        if (!localStorage.getItem('isLoggedIn') || localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }
    </script>
</head>
<body class="projects-body">
    <div class="page-content">
        <h1>Projects <span id="realtimeIndicator" style="display: inline-flex; align-items: center; font-size: 0.7rem; color: #4CAF50; margin-left: 0.5rem; font-weight: normal;"><i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.3rem; animation: pulse 2s infinite;"></i>Live</span></h1>
        
        <!-- KPI Blocks -->
        <div class="projects-kpi-container">
            <div class="projects-kpi-block projects-kpi-clickable" id="myTasksKpi" style="cursor: pointer;" title="Click to view your assigned tasks">
                <div class="projects-kpi-value" id="kpiMyTasks">0</div>
                <div class="projects-kpi-label">My Tasks</div>
            </div>
            <div class="projects-kpi-block">
                <div class="projects-kpi-value" id="kpiDueToday">0</div>
                <div class="projects-kpi-label">Due Today</div>
            </div>
            <div class="projects-kpi-block projects-kpi-overdue">
                <div class="projects-kpi-value" id="kpiOverdue">0</div>
                <div class="projects-kpi-label">Overdue</div>
            </div>
            <div class="projects-kpi-block">
                <div class="projects-kpi-value" id="kpiTotal">0</div>
                <div class="projects-kpi-label">Total Tasks</div>
            </div>
        </div>
        
        <div id="projectsTopLinks" class="projects-top-links"></div>
        <div id="main-pods" class="projects-grid">
            <!-- Pods will be rendered here by projects.js -->
        </div>
        
        <!-- Global Completed Tasks Section -->
        <div id="globalCompletedSection" class="global-completed-section" style="display:none;">
            <div class="global-completed-header">
                <h2>Completed Tasks</h2>
                <button id="toggleGlobalCompleted" class="global-completed-toggle">Show completed tasks (0)</button>
            </div>
        </div>
    </div>
    <!-- Navigation -->
    <nav-menu></nav-menu>
    <script src="navigation.js"></script>
    <script type="module" src="projects.js"></script>

    <!-- Task Delete Confirmation Modal -->
    <div id="taskDeleteModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:420px;">
            <span class="close" id="taskDeleteClose">&times;</span>
            <h2>Delete Task</h2>
            <p id="taskDeleteMessage">Are you sure you want to delete this task?</p>
            <div style="display:flex; gap:10px; margin-top:14px; justify-content:flex-start;">
                <button id="taskDeleteCancel" class="cancel-comment-btn">Cancel</button>
                <button id="taskDeleteConfirm" class="save-comment-btn" style="background:#e74c3c;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Recurring Task Modal -->
    <div id="recurringModal" class="recurring-modal hidden">
        <div class="recurring-modal-content">
            <div class="recurring-modal-header">
                <h3>Recurring Task</h3>
                <button id="closeRecurringModal" class="recurring-modal-close">&times;</button>
            </div>
            <div class="recurring-modal-body">
                <div class="recurring-field">
                    <label>Repeats</label>
                    <select id="recurringFrequency" class="recurring-select">
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                
                <div class="recurring-field" id="recurringDaysSection">
                    <label>On these days</label>
                    <div class="recurring-days">
                        <label class="recurring-day-option">
                            <input type="checkbox" value="0" />
                            <span>S</span>
                        </label>
                        <label class="recurring-day-option">
                            <input type="checkbox" value="1" />
                            <span>M</span>
                        </label>
                        <label class="recurring-day-option">
                            <input type="checkbox" value="2" />
                            <span>T</span>
                        </label>
                        <label class="recurring-day-option">
                            <input type="checkbox" value="3" />
                            <span>W</span>
                        </label>
                        <label class="recurring-day-option">
                            <input type="checkbox" value="4" checked />
                            <span>T</span>
                        </label>
                        <label class="recurring-day-option">
                            <input type="checkbox" value="5" />
                            <span>F</span>
                        </label>
                        <label class="recurring-day-option">
                            <input type="checkbox" value="6" />
                            <span>S</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="recurring-modal-footer">
                <button id="clearRecurringBtn" class="recurring-clear-btn">Turn Off Recurring</button>
                <button id="saveRecurringBtn" class="recurring-save-btn">Save</button>
            </div>
        </div>
    </div>

    <!-- Task Details Drawer -->
    <div id="taskDrawer" class="projects-drawer hidden">
        <div class="projects-drawer-header">
            <h3 id="drawerTaskTitle">Task Details</h3>
            <button id="closeTaskDrawer" class="projects-drawer-close" aria-label="Close">&times;</button>
        </div>
        <div class="projects-drawer-body">
            <label class="projects-drawer-label" for="drawerLongDescription">Long Description</label>
            <textarea id="drawerLongDescription" class="projects-drawer-textarea" placeholder="Add a detailed description..."></textarea>

            <div class="projects-drawer-section">
                <div class="projects-drawer-section-header">
                    <span>Attachments (URLs)</span>
                    <button id="addAttachmentBtn" class="projects-drawer-add">+ Add</button>
                </div>
                <ul id="attachmentsList" class="projects-drawer-attachments"></ul>
            </div>
        </div>
        <div class="projects-drawer-footer">
            <button id="saveTaskDetailsBtn" class="save-comment-btn">Save</button>
            <button id="cancelTaskDetailsBtn" class="cancel-comment-btn">Cancel</button>
        </div>
    </div>

    <!-- My Tasks Modal -->
    <div id="myTasksModal" class="modal" style="display:none;">
        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 900px; max-height: 70vh; background-color: #fefefe; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 1001; display: flex; flex-direction: column;">
            <span class="close" id="closeMyTasksModal" style="position: absolute; right: 1.5rem; top: 1rem; font-size: 2rem; z-index: 10; cursor: pointer; color: #666;">&times;</span>
            <div style="padding: 2rem 2rem 1rem 2rem; border-bottom: 1px solid #eee; flex-shrink: 0;">
                <h2 style="margin: 0 0 1rem 0;">Tasks</h2>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="taskUserFilter" style="font-weight: 500; color: #333;">User:</label>
                        <select id="taskUserFilter" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9rem; min-width: 150px;">
                            <option value="">All Users</option>
                            <!-- Options will be populated dynamically from users list -->
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="taskProjectFilter" style="font-weight: 500; color: #333;">Project:</label>
                        <select id="taskProjectFilter" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9rem; min-width: 200px;">
                            <option value="">All Projects</option>
                            <!-- Options will be populated dynamically from visible projects -->
                        </select>
                    </div>
                </div>
            </div>
            <div id="myTasksContent" style="overflow-y: auto; overflow-x: hidden; padding: 1.5rem 2rem; flex: 1; min-height: 200px;">
                <!-- Task list will be populated here -->
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal" style="display:none;">
        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 700px; max-height: 80vh; background-color: #fefefe; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 1001; display: flex; flex-direction: column;">
            <span class="close" id="closeNotificationsModal" style="position: absolute; right: 1.5rem; top: 1rem; font-size: 2rem; z-index: 10; cursor: pointer; color: #666;">&times;</span>
            <div style="padding: 2rem 2rem 1rem 2rem; border-bottom: 1px solid #eee; flex-shrink: 0;">
                <h2 style="margin: 0 0 0.5rem 0;">Notifications</h2>
                <div style="display: flex; gap: 1rem;">
                    <button id="markAllReadBtn" style="background: none; border: none; color: #2196F3; font-size: 0.9rem; cursor: pointer; padding: 0.5rem 0; text-decoration: underline;">Mark all as read</button>
                    <button id="deleteAllNotificationsBtn" style="background: none; border: none; color: #ff3b30; font-size: 0.9rem; cursor: pointer; padding: 0.5rem 0; text-decoration: underline;">Delete all</button>
                </div>
            </div>
            <div id="notificationsContent" style="overflow-y: auto; overflow-x: hidden; padding: 1rem 2rem; flex: 1; min-height: 200px;">
                <!-- Notifications will be populated here -->
            </div>
        </div>
    </div>
</body>
</html>
